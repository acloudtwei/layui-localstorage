!function(a,f){var i={easyId:"",accept:".jpg,.png,.pdf",action:"",btnText:{select:"选择文件",upload:"上传",delete:"删除",cancel:"终止"},maxCount:3,maxSize:3,multiple:!0,messageTime:2e3,responseType:"text",showSize:!0,showLoading:!1,statusText:{0:"允许上传",1:"即将上传",2:"0%",3:"上传成功",4:"上传失败",5:"体积超出"},statusTextColor:{0:"normalcolor",1:"normalcolor",2:"normalcolor",3:"normalcolor",4:"failedcolor",5:"warncolor"},statusBg:{0:"normalbg",1:"normalbg",2:"normalbg",3:"normalbg",4:"failedbg",5:"warnbg"},timeout:0,withCredentials:!0,setRequestHeader:null,buildSendData:null,checkSuccessCode:null};function l(e){var s,t=this instanceof l?this:Object.create(l.prototype);return t.configs=Object.assign({},i,e),t.files=[],t.fileId=0,t.xhrFiles=[],t.isXhrReady=!0,t.xhr=new XMLHttpRequest,e='<span class="message-box">我是message</span><div class="loading"><div class="loading-icon"></div><div class="loading-mask"></div></div><input type="file" name="file" class="input-file"'+((s=t).configs.multiple?"multiple":"")+' accept="'+s.configs.accept+'"><div class="btn-list"><div btntype="select" class="btn btn-list-item btnlist-item-selsct">'+s.configs.btnText.select+'</div><div btntype="upload" class="btn btn-list-item btnlist-item-upload">'+s.configs.btnText.upload+'</div><div btntype="delete" class="btn btn-list-item btnlist-item-danger">'+s.configs.btnText.delete+'</div><div btntype="cancel" class="btn btn-list-item btnlist-item-danger">'+s.configs.btnText.cancel+'</div><div btntype="checkall" class="btn btn-list-item checkbox unchecked">✓</div></div><ul class="file-list"></ul>',f.getElementById(s.configs.easyId).innerHTML=e,function(t){f.getElementById(t.configs.easyId).querySelector(".btn-list").onclick=function(e){var s;switch(((e=e||a.event).target||e.srcElement).getAttribute("btntype")){case"select":f.getElementById(t.configs.easyId).querySelector(".input-file").click();break;case"upload":!function(s){for(var t,e=0;e<s.files.length;e++)!s.files[e].isChecked||4!=s.files[e].status&&0!=s.files[e].status&&3!=s.files[e].status||(s.files[e].status=1,s.xhrFiles.push(s.files[e]));function i(){s.xhrFiles[t].status=2,n(s),s.xhr.open("post",s.configs.action),s.xhr.timeout=s.configs.timeout,s.xhr.responseType=s.configs.responseType,s.xhr.withCredentials=s.configs.withCredentials,s.configs.setRequestHeader&&s.configs.setRequestHeader(s.xhr),s.xhr.addEventListener("progress",function(e){e=String((e.loaded/e.total*100).toFixed(2))+"%";s.xhrFiles[t].progress=e,c(s,{progress:e,id:s.xhrFiles[t].id,status:s.xhrFiles[t].status})}),s.xhr.onreadystatechange=function(){var e;4==s.xhr.readyState&&(e={progress:s.xhrFiles[t].progress,id:s.xhrFiles[t].id,status:s.xhrFiles[t].status},200==s.xhr.status&&null==s.configs.checkSuccessCode||s.configs.checkSuccessCode(s.xhr)?(p(s,e),c(s,e),l(3)):(p(s,e),c(s,e),l(4)))},null==s.configs.buildSendData?s.xhr.send(null):s.xhr.send(s.configs.buildSendData(s.xhrFiles[t]))}function l(e){s.xhrFiles[t].status=e,n(s),t++,s.isXhrReady=!0,t<s.xhrFiles.length?i():(s.xhrFiles=[],t=0,s.configs.showLoading&&y(s,!1))}s.xhrFiles.length?(n(s),s.isXhrReady&&(t=0,s.isXhrReady=!1,s.configs.showLoading&&y(s,!0),i())):s.files.length&&b(s,{text:"未选中有效文件",class_name:s.configs.statusBg[5]})}(t);break;case"delete":o(t),d(t,"delete"),r(t);break;case"cancel":(s=t).xhr.onabort=function(){b(s,{text:"成功取消上传",class_name:s.configs.statusBg[3]})},s.xhr.abort();break;case"checkall":d(t,"click"),u(t)}}}(s),function(o){f.getElementById(o.configs.easyId).querySelector(".input-file").addEventListener("change",function(){var n=0,c=this;function a(e){o.files.length<o.configs.maxCount?(o.files.push(e),o.fileId++):b(o,{text:"文件数量超出",class_name:o.configs.statusBg[5]})}!function s(){var t,e,i,l;n<c.files.length?(t={id:o.fileId,name:c.files[n].name,size:c.files[n].size,type:c.files[n].type,isChecked:!1,status:0,progress:"0%",file:c.files[n]},/image\//.test(c.files[n].type)?(e=c.files[n],i=function(e){t.base64=e,a(t),n++,s()},(l=new FileReader).onload=function(){i&&i(this.result)},l.readAsDataURL(e)):(a(t),n++,s())):(d(o),r(o))}()})}(s),t}function r(e){for(var s,t,i,l,n="",c=0;c<e.files.length;c++)n+='<li class="file-list-item" fileid="'+e.files[c].id+'"><div class="preview">'+(/image\//.test(e.files[c].type)?'<img class="preview-img" src="'+e.files[c].base64+'" alt="'+e.files[c].name+'">':'<div class="preview-div"></div>')+'</div><div class="btn-file"><div btntype="delone" class="btn btn-file-del" fileid="'+e.files[c].id+'"><span btntype="delone" class="btn-file-del-text" fileid="'+e.files[c].id+'">X</span></div><div btntype="checkone" class="btn btn-file-checkbox checkbox '+(e.files[c].isChecked?"checked":"unchecked")+'" fileid="'+e.files[c].id+'">✓</div></div><div class="fileinfo"><p class="fileinfo-text"><span class="fileinfo-text-name">'+(e.configs.showSize?'<i class="fileinfo-text-size '+(t=(s=e).files[c],i=void 0,i=(t.size/Math.pow(1024,2)).toFixed(2),s.configs.maxSize>i?s.configs.statusBg[0]:(t.status=5,s.configs.statusBg[5]))+'">'+function(e){if(0===e)return"0 B";var s=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,s)).toPrecision(3)+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][s]}(e.files[c].size)+"</i>":"")+e.files[c].name+'</span><span class="fileinfo-text-status '+e.configs.statusTextColor[e.files[c].status]+'" fileid="'+e.files[c].id+'">'+e.configs.statusText[e.files[c].status]+'</span></p><div class="fileinfo-progress"><div class="fileinfo-progress-bar '+e.configs.statusBg[e.files[c].status]+'" style="width:'+e.files[c].progress+';" fileid="'+e.files[c].id+'"></div></div></div></li>';f.getElementById(e.configs.easyId).querySelector(".file-list").innerHTML=n,l=e,f.getElementById(l.configs.easyId).querySelector(".file-list").onclick=function(e){var e=(e=e||a.event).target||e.srcElement,s=e.getAttribute("fileid");switch(e.getAttribute("btntype")){case"checkone":!function(e,s){for(var t=0;t<e.files.length;t++)e.files[t].id==s&&(e.files[t].isChecked=!e.files[t].isChecked)}(l,s),d(l),u(l,s);break;case"delone":o(l,s),d(l),r(l)}}}function o(e,s){if(!e.files.length||g(e)||null!=s){for(var t=[],i=0;i<e.files.length;i++)s&&e.files[i].id!=s&&t.push(e.files[i]),s||e.files[i].isChecked||t.push(e.files[i]);e.files=t}else b(e,{text:"未选中文件",class_name:e.configs.statusBg[5]})}function d(e,s){var t,i=f.getElementById(e.configs.easyId).querySelector(".btn-list").querySelector(".checkbox");e.files.length?(t=g(e)==e.files.length,"click"==s?(m(i,!t),function(e,s){for(var t=0;t<e.files.length;t++)e.files[t].isChecked=s}(e,!t)):m(i,t)):"delete"!=s&&(/\sunchecked$/.test(i.className)?m(i,!0):/\schecked$/.test(i.className)&&m(i,!1))}function u(e,s){var t=f.getElementById(e.configs.easyId);if(s){var i=h(e,s);m(t.querySelector('[fileid="'+s+'"]').querySelector(".checkbox"),i.isChecked)}else for(var l=g(e)==e.files.length,n=t.querySelectorAll(".file-list-item"),c=0;c<n.length;c++)m(n[c].querySelector(".checkbox"),l)}function g(e){for(var s=0,t=0;t<e.files.length;t++)e.files[t].isChecked&&s++;return s}function h(e,s){for(var t=0;t<e.files.length;t++)if(e.files[t].id==s)return e.files[t]}function n(e){for(var s=f.getElementById(e.configs.easyId).querySelectorAll(".file-list-item"),t=0;t<s.length;t++){var i=s[t].getAttribute("fileid");s[t].querySelector(".fileinfo-text-status").innerHTML=e.configs.statusText[h(e,i).status]}}function c(e,s){var t=f.getElementById(e.configs.easyId).querySelector('[fileid="'+s.id+'"]').querySelector(".fileinfo-progress-bar");t.style.width=s.progress,t.className="fileinfo-progress-bar "+e.configs.statusBg[s.status]}function p(e,s){for(var t=f.getElementById(e.configs.easyId).querySelectorAll(".fileinfo-text-status"),i=0;i<t.length;i++)s.id==t[i].getAttribute("fileid")&&(t[i].className="fileinfo-text-status "+e.configs.statusTextColor[s.status])}function m(e,s){s?/\sunchecked$/.test(e.className)&&(e.className=e.className.replace("unchecked","checked")):/\schecked$/.test(e.className)&&(e.className=e.className.replace("checked","unchecked"))}function y(e,s){f.getElementById(e.configs.easyId).querySelector(".loading").style.display=s?"block":"none"}function b(e,s){var t=f.getElementById(e.configs.easyId).querySelector(".message-box");t.className="message-box "+s.class_name,t.style.display="inline-block",t.innerHTML=s.text,setTimeout(function(){t.style.display="none"},e.configs.messageTime)}l.prototype={constouctor:l},a.easyUpload=l}(window,document);